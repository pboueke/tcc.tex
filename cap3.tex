\section{Arquitetura}

\begin{figure}
\begin{center}
\parbox[htb]{13.0cm}
  {
  \begin{center}
  \includegraphics[scale=0.40]{framework.png}
  \caption[\small{Diagrama de componentes da aplicação.}]{\label{FigDel} \small{Diagrama de componentes da aplicação.}}
  \end{center}
  }
\end{center}
\end{figure}

\paragraph{}O projeto desenvolvido se trata de uma aplicação \textit{Django} que conta com três interfaces, uma para execução de um modelo preditivo em ocorrências controladas, outra para monitoramento do banco de dados e outra para o disparo escalonado de predições, chamadas, respectivamente, de \textit{Showroom}, \textit{Monitor} e \textit{Disparo}. Essas três interfaces são controladas pela aplicação por meio de três classes, vistas na figura 3.1. Os componentes da aplicação podem ser visualizados na figura 3.2, onde se observa a existência de um arquivo \textit{config.yaml}, responsável por agregar todos os parâmetros e configurações da aplicação.


\section{Implementação}

\paragraph{} No modelo seguido pelo \textit{framework Django}, o modelo \textit{MTV}, todas as páginas e interfaces da aplicação são renderizadas a partir de templates HTML preenchidos pelo controlador da aplicação, que no caso se trata do arquivo \textit{views.py}. Os templates HTML se encontram dentro do diretório \textit{templates}. Os modelos se encontram no arquivo models.py, fazendo uso direto das classes de modelo do \textit{framework}. As componentes \textit{monitor.py}, \textit{showroom.py} e \textit{dispatch.py} se encontram no diretório \textit{scripts}.

\begin{figure}
\begin{center}
\parbox[htb]{13.0cm}
  {
  \begin{center}
  \includegraphics[scale=0.30]{framework_clases.png}
  \caption[\small{Diagrama de classes da aplicação.}]{\label{FigDel} \small{Diagrama de classes da aplicação.}}
  \end{center}
  }
\end{center}
\end{figure}


\subsection{Configuração}

\paragraph{}Toda a configuração da aplicação é feita a partir de dois arquivos, o \textit{settings.py} e o \textit{config.yaml}. No primeiro são configuradas as propriedades básicas de uma aplicação \textit{Django}, se tratando de seu arquivo de configuração padrão. No segundo, estão as configurações específicas à aplicação. O caminho ao arquivo \textit{config.yaml} é escrito como a variável \textit{CONFIG\_FILE}, dentro do arquivo \textit{settings.py}, para que as configurações possam ser carregadas na aplicação durante sua inicialização.

\paragraph{} O arquivo \textit{config.yaml} contém todos os parâmetros necessários para o funcionamento da aplicação. DETALHAR TODOS NUMA TABELA?

\subsection{Showroom}

\paragraph{}A \textit{view Showroom} é caracterizada pela existência de casos sobre os quais serão inferidas classificações a partir do modelo de aprendizado de máquina carregado na aplicação. Toda execução gerada a partir dessa \textit{view} segue os passos vistos no diagrama de sequência apresentado na figura 3.4. Os dados para a predição são coletados, o evento é registrado na tabela de log de eventos, o resultado é computado e a \textit{view} é atualizada com os resultados da predição. A tabela de log de enventos, por sua vez, é populada por eventos relacionados a cada execução, representados pelas colunas da entidade \textit{ShowroomDispatch} na figura 3.3.

\begin{figure}
\begin{center}
\parbox[htb]{13.0cm}
  {
  \begin{center}
  \includegraphics[scale=0.50]{ERD.png}
  \caption[\small{Diagrama Entidade-Relacionamento do banco.}]{\label{FigDel} \small{Diagrama Entidade-Relacionamento do banco.}}
  \end{center}
  }
\end{center}
\end{figure}

\begin{figure}
\begin{center}
\parbox[htb]{13.0cm}
  {
  \begin{center}
  \includegraphics[scale=0.30]{sequence.png}
  \caption[\small{Diagrama de sequência da \textit{view Showroom}.}]{\label{FigDel} \small{Diagrama de sequência da \textit{view Showroom}.}}
  \end{center}
  }
\end{center}
\end{figure}

\subsection{Disparo}

\paragraph{} A \textit{view Disparo} é responsável por permitir a visualização dos disparos executados, onde cada disparo é dado pela execução do script de inferência.

\subsection{Monitor}

\paragraph{} A \textit{view Monitor} é responsável por monitorar: o estado de um \textit{host}, o estado do banco de dados, as datas dos último e próximo disparos e o estado do processo a ser executado. Em intervalos periódicos de tempo a \textit{view} é atualizada trazendo informações recentes para a interface.

\paragraph{} Para a verificação do estado do \textit{host}, uma conexão socket é criada em uma porta aberta qualquer do host. A conexão é tida como \textit{offline} se ocorrer um timeout, sendo 10 segundos o intervalo de tempo para que isso ocorra. O host informado pode ser tanto como um endereço IPV4 quanto um endereço IPV6.

\paragraph{} A verificação do estado do banco de dados é feita por meio de uma conexão, usando a cadeia de conexão adequada ao banco a ser conectado. Após a conexão ser estabelecida, é realizada uma consulta simples em uma tabela qualquer pertencente ao banco, sem que nada seja retornado, com o intuito de que todos os passos da conexão sejam testados. Caso ocorra algum problema em algum momento durante a tentativa de conexão, esse problema é reportado.

\paragraph{} O último disparo e o estado do próximo disparo são monitorados fazendo uso da biblioteca \textit{crontab} para \textit{Python 3}. Tanto a agenda de execuções quanto o comando a ser executado pelo \textit{daemon cron} são obtidos por meio do uso dessa biblioteca.Nessa \textit{view}, o estado da execução do comando pode ser alterado por meio de um botão que remove o comando do arquivo \textit{crontab} e outro que o insere.

\section{Implantação}

\begin{figure}
\begin{center}
\parbox[htb]{13.0cm}
  {
  \begin{center}
  \includegraphics[scale=0.50]{deployment.png}
  \caption[\small{Diagrama de implantação.}]{\label{FigDel} \small{Diagrama de implantação}}
  \end{center}
  }
\end{center}
\end{figure}

A implantação do sistema depende de um servidor de aplicação e um servidor para o banco de dados, como visto na figura 3.5. A aplicação \textit{Django} será hospedada no servidor de aplicação enquanto que o banco de dados será hospedado em uma máquina que permita o acesso da máquina da aplicação ao serviço de banco de dados hospedado.
